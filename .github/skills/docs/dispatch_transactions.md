# Dispatch transactions

概要
- 配車に関するトランザクション設計、整合性保持、ロック戦略、イベント発行。

目的
- 同時更新や競合状態に対して安全に配車処理を行う。

主要トピック
- トランザクション境界の決定（どの処理を単一トランザクションに含めるか）。
- 悲観ロック（`SELECT ... FOR UPDATE`）と楽観ロック（バージョンカラム）の使い分け。
- イベントの発行（例: dispatch.created）と補償ロジック。

チェックリスト
- [ ] トランザクションは短く保たれている
- [ ] 競合時のリトライ/エラー方針が定義されている
- [ ] イベントは冪等に処理される

関連ファイル
- src/modules/dispatch/
- tests/integration/test_dispatch_flow.spec.ts

設計ノート
- 同時配車を防ぐためにユニットのロック取得を検討する。